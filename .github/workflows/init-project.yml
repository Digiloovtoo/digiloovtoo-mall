name: Initsialiseeri Digiloovt√∂√∂ Projekt
on:
  push:
    branches: [main, master]
    paths:
      - "README.md" # K√§ivitub vaid siis, kui README faili muudetakse v√µi esmasel loomisel

jobs:
  create-issues:
    runs-on: ubuntu-latest
    permissions:
      issues: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Loo sildid ja esialgsed √ºlesanded
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # 1. Kontrollime, kas issuesid juba on
          COUNT=$(gh issue list --state all --json number --jq length)

          if [ "$COUNT" -eq "0" ]; then
            echo "Alustan projekti initsialiseerimist..."

            # 2. LOOME SILDID (See parandab vea)
            # Kasutame --force lippu, et kui silt on juba olemas, siis viga ei teki.
            gh label create "seadistus" --color "fbca04" --description "Projekti √ºlesseadmine" --force
            gh label create "anal√º√ºs" --color "0e8a16" --description "Uuringud ja anal√º√ºs" --force
            gh label create "planeerimine" --color "5319e7" --description "Sprintide planeerimine" --force

            # 3. LOOME √úLESANDED
            
            gh issue create \
              --title "üöÄ SAMM 1: Seadista Projektitahvel (Board)" \
              --body "Selleks, et t√∂√∂d hallata, tuleb luua tahvel.\n\n1. Vali √ºlevalt men√º√ºst **Projects**.\n2. Vajuta rohelist nuppu **Link a project** -> **New project**.\n3. Vali **Board** mall.\n4. Pane nimeks 'Digiloovt√∂√∂' ja salvesta.\n5. Tule siia tagasi ja m√§rgi see √ºlesanne tehtuks!" \
              --label "seadistus"

            gh issue create \
              --title "Persoonade ja stsenaariumide loomine" \
              --body "## √úlesanne\nLuuakse projekti sihtr√ºhma persoonad ja kasutusstsenaariumid.\n\n- [ ] Loo Wiki leht 'Persoonad'\n- [ ] Lisa v√§hemalt 2 persoonat piltide ja kirjeldusega\n- [ ] Loo Wiki leht 'Stsenaariumid'" \
              --label "anal√º√ºs"

            gh issue create \
              --title "Esimese Sprindi planeerimine" \
              --body "Vaadake tiimiga √ºle 'Persoonad' ja otsustage, mida teete esimeses sprindis.\n- [ ] Loo User Storyd\n- [ ] Hinda t√∂√∂de mahtu" \
              --label "planeerimine"
              
            echo "Esialgsed √ºlesanded ja sildid loodud!"
          else
            echo "√úlesanded on juba olemas, ei loo uuesti."
          fi
