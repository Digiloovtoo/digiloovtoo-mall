name: Initsialiseeri Digiloovt√∂√∂ Projekt
on:
  push:
    branches: [main, master]
    paths:
      - "README.md" # K√§ivitub vaid siis, kui README faili muudetakse v√µi esmasel loomisel

jobs:
  create-issues:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Loo sildid ja esialgsed √ºlesanded
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # 1. Kontrollime, kas issuesid juba on
          COUNT=$(gh issue list --state all --json number --jq length)

          if [ "$COUNT" -eq "0" ]; then
            echo "Alustan projekti initsialiseerimist..."

            # 2. LOOME SILDID
            gh label create "seadistus" --color "fbca04" --description "Projekti √ºlesseadmine" --force
            gh label create "anal√º√ºs" --color "0e8a16" --description "Uuringud ja anal√º√ºs" --force
            gh label create "planeerimine" --color "5319e7" --description "Sprintide planeerimine" --force

            # 3. LOOME √úLESANDED (Kasutame EOF meetodit korrektse vorminduse jaoks)
            
            # --- √úlesanne 1 sisu ---
            BODY_SEADISTUS=$(cat <<EOF
            Selleks, et t√∂√∂d hallata, tuleb luua tahvel.

            1. Vali √ºlevalt men√º√ºst **Projects**.
            2. Vajuta rohelist nuppu **Link a project** -> **New project**.
            3. Vali **Board** mall.
            4. Pane nimeks 'Digiloovt√∂√∂' ja salvesta.
            5. Tule siia tagasi ja m√§rgi see √ºlesanne tehtuks!
            EOF
            )

            gh issue create \
              --title "üöÄ SAMM 1: Seadista Projektitahvel (Board)" \
              --body "$BODY_SEADISTUS" \
              --label "seadistus"

            # --- √úlesanne 2 sisu ---
            BODY_ANALUYS=$(cat <<EOF
            ## √úlesanne
            Luuakse projekti sihtr√ºhma persoonad ja kasutusstsenaariumid.

            - [ ] Loo Wiki leht 'Persoonad'
            - [ ] Lisa v√§hemalt 2 persoonat piltide ja kirjeldusega
            - [ ] Loo Wiki leht 'Stsenaariumid'
            EOF
            )

            gh issue create \
              --title "Persoonade ja stsenaariumide loomine" \
              --body "$BODY_ANALUYS" \
              --label "anal√º√ºs"

            # --- √úlesanne 3 sisu ---
            BODY_PLANEERIMINE=$(cat <<EOF
            Vaadake tiimiga √ºle 'Persoonad' ja otsustage, mida teete esimeses sprindis.

            - [ ] Loo User Storyd (kasutades vastavat Issue malli)
            - [ ] Hinda t√∂√∂de mahtu
            EOF
            )

            gh issue create \
              --title "Esimese Sprindi planeerimine" \
              --body "$BODY_PLANEERIMINE" \
              --label "planeerimine"
              
            echo "Esialgsed √ºlesanded ja sildid edukalt loodud!"
          else
            echo "√úlesanded on juba olemas, ei loo uuesti."
          fi
